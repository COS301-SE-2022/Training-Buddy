"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[984],{5984:(M,b,r)=>{r.r(b),r.d(b,{ClientStravaFeatureModule:()=>L});var v=r(9808),d=r(5357),t=r(5e3),l=r(520),y=r(9444),o=r(2160);let i=(()=>{class e{constructor(n,s,f,C){this.http=n,this.apollo=s,this.router=f,this.cookie=C,this.client_id="85093",this.client_secret="a104b3a3699b54450312f26698167e28b61d5624",this.grant_type="authorization_code",this.OAuthURI=`https://www.strava.com/oauth/authorize?client_id=${this.client_id}&response_type=code&redirect_uri=https://training-buddy-2022.web.app/exchange_token&approval_prompt=force&scope=activity:read_all`,this.OAuth=null,this.userToken=null,this.loading=!1}OAuthPage(){location.href=this.OAuthURI}setOAuthResponse(n){this.OAuth=n,this.isOAuthValid()&&(this.loading=!0,this.getUserToken())}getUserToken(){this.loading=!0;const n=(new l.LE).set("client_id",this.client_id).set("client_secret",this.client_secret).set("code",this.OAuth.code).set("grant_type",this.grant_type);this.http.post("https://www.strava.com/oauth/token",n).subscribe({next:s=>{this.userToken=s,console.log(s),this.sendTokens(this.userToken.access_token,this.userToken.refresh_token,this.userToken.expires_at,this.client_id,this.client_secret,this.userToken.athlete.id).subscribe({next:w=>{console.log(w),this.router.navigate(["dashboard"])},error:w=>{}})},error:s=>{this.userToken=null}})}sendTokens(n,s,f,C,A,S){return this.apollo.mutate({mutation:y.Ps`mutation{
          saveTokens(
            email: "${this.cookie.get("email")}",
            access: "${n}",
            refresh: "${s}",
            exp: ${Number(f)},
            clientId: "${C}",
            clientSecret: "${A},"
            id: "${S}"
        ){
          message
        }
        }
        `})}getActivities(){this.http.get("https://www.strava.com/api/v3/athlete/activities?per_page=200&access_token="+this.userToken.access_token).subscribe({next:n=>{console.log(n)},error:n=>{console.log(n)}})}isOAuthValid(){return null==this.OAuth?null:!this.OAuth.error}isTokenValid(){return null!=this.userToken}logOAuth(){console.log(this.OAuth)}logUserToken(){console.log(this.userToken)}isLoading(){return this.loading}}return e.\u0275fac=function(n){return new(n||e)(t.LFG(l.eN),t.LFG(y._M),t.LFG(d.F0),t.LFG(o.N))},e.\u0275prov=t.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),c=(()=>{class e{constructor(n,s,f){this.strava=n,this.activeRoute=s,this.router=f}ngOnInit(){this.activeRoute.queryParams.subscribe(n=>{this.strava.setOAuthResponse(n),this.router.navigate(["strava/link"])})}}return e.\u0275fac=function(n){return new(n||e)(t.Y36(i),t.Y36(d.gz),t.Y36(d.F0))},e.\u0275cmp=t.Xpm({type:e,selectors:[["training-buddy-strava-exchangetoken"]],decls:2,vars:0,template:function(n,s){1&n&&(t.TgZ(0,"p"),t._uU(1,"stravaexchangetoken works!"),t.qZA())},styles:[""]}),e})();var g=r(3954),h=r(9224),m=r(2786),k=r(7322),p=r(773),a=r(7423);function x(e,u){1&e&&(t.O4$(),t.TgZ(0,"svg",10),t._UZ(1,"path",11)(2,"path",12),t.qZA())}function O(e,u){1&e&&t._UZ(0,"mat-spinner")}const T=function(e){return{"background-image":e}},_=[{path:"",component:c},{path:"link",component:(()=>{class e{constructor(n,s){this.router=n,this.strava=s,this.img="https://images.unsplash.com/photo-1607962837359-5e7e89f86776?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=2070&q=80",this.OAuthError=!1,0==this.strava.isOAuthValid()&&(this.OAuthError=!0),this.loading=this.strava.isLoading()}ngOnInit(){console.log()}LinkToStrava(){this.loading||this.strava.OAuthPage()}NoLinking(){this.loading||this.router.navigate(["dashboard"])}}return e.\u0275fac=function(n){return new(n||e)(t.Y36(d.F0),t.Y36(i))},e.\u0275cmp=t.Xpm({type:e,selectors:[["training-buddy-strava-link"]],decls:24,vars:5,consts:[["id","background",3,"ngStyle"],["cols","1","rowHeight","fit"],["id","logo"],["id","logo","height","70","dark","true"],["id","center",1,"mt-5"],["id","stravaLogo","xmlns","http://www.w3.org/2000/svg","aria-label","Strava","viewBox","0 0 512 512",4,"ngIf"],[4,"ngIf"],[1,"submitButton","mt-3"],["type","button","id","linkStrava","mat-raised-button","","color","primary",1,"text-center","ml-1",3,"click"],["type","button","id","linkLater","mat-raised-button","","color","primary",1,"text-center","ml-1",3,"click"],["id","stravaLogo","xmlns","http://www.w3.org/2000/svg","aria-label","Strava","viewBox","0 0 512 512"],["fill","#FC4C02","d","M120 288L232 56l112 232h-72l-40-96-40 96z"],["fill","#fda580","d","M280 288l32 72 32-72h48l-80 168-80-168z"]],template:function(n,s){1&n&&(t.TgZ(0,"div",0)(1,"mat-grid-list",1)(2,"mat-grid-tile")(3,"mat-card")(4,"mat-card-content")(5,"div",2),t._UZ(6,"training-buddy-logo",3),t.qZA(),t.TgZ(7,"div",4)(8,"mat-hint"),t._uU(9,"This will allow us to match you with buddies that have similar training to you."),t.qZA()(),t.YNc(10,x,3,0,"svg",5),t.YNc(11,O,1,0,"mat-spinner",6),t.TgZ(12,"div",4)(13,"mat-hint"),t._uU(14,"By not linking strava you will need to manually add activities for buddies to be suggested. "),t._UZ(15,"br"),t._uU(16," (Strava can be linked later through your profile page)"),t.qZA()(),t._UZ(17,"br"),t.TgZ(18,"div",7)(19,"button",8),t.NdJ("click",function(){return s.LinkToStrava()}),t._uU(20,"Link Strava"),t.qZA()(),t.TgZ(21,"div",7)(22,"button",9),t.NdJ("click",function(){return s.NoLinking()}),t._uU(23,"Add Manually/Link Later"),t.qZA()()()()()()()),2&n&&(t.Q6J("ngStyle",t.VKq(3,T,"url("+s.img+")")),t.xp6(10),t.Q6J("ngIf",!s.loading),t.xp6(1),t.Q6J("ngIf",s.loading))},directives:[v.PC,g.Il,g.DX,h.a8,h.dn,m.R,k.bx,v.O5,p.Ou,a.lW],styles:["mat-grid-list[_ngcontent-%COMP%]{height:100vw;max-height:80vh;min-height:600px}@media (max-width: 300px){mat-grid-list[_ngcontent-%COMP%]{background-color:transparent}}@media (max-width: 1035px){mat-grid-list[_ngcontent-%COMP%]{height:100vh}}mat-card[_ngcontent-%COMP%]{width:90vw;max-width:400px;margin-top:30%}mat-spinner[_ngcontent-%COMP%]{margin:9% auto 4%}[_nghost-%COMP%]     .mat-progress-spinner circle, .mat-spinner[_ngcontent-%COMP%]   circle[_ngcontent-%COMP%]{stroke:#fc4c02}.text-center[_ngcontent-%COMP%]{text-align:center}mat-form-field[_ngcontent-%COMP%]{display:block}.row[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:flex-end}#background[_ngcontent-%COMP%]{height:100vh;background-size:cover;background-repeat:no-repeat}mat-error[_ngcontent-%COMP%]{text-align:right}mat-hint[_ngcontent-%COMP%]{text-align:right!important}#center[_ngcontent-%COMP%]{text-align:center}#logo[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:center;width:100%;margin-top:2%}#stravaLogo[_ngcontent-%COMP%]{height:150px;margin-left:auto;margin-right:auto}#stravaText[_ngcontent-%COMP%]{height:40px;margin-left:auto;margin-right:auto}.submitButton[_ngcontent-%COMP%]{text-align:center}#linkStrava[_ngcontent-%COMP%]{width:100%;background-color:#1b1a1b}#linkLater[_ngcontent-%COMP%]{width:100%;background-color:#fff;color:#1b1a1b}"]}),e})()}];let I=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[d.Bz.forChild(_)],d.Bz]}),e})();var P=r(7918);let L=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[v.ez,P.W,I]]}),e})()},2160:(M,b,r)=>{r.d(b,{N:()=>t});var v=r(5e3),d=r(9808);let t=(()=>{class l{constructor(o,i){this.document=o,this.platformId=i,this.documentIsAccessible=(0,d.NF)(this.platformId)}static getCookieRegExp(o){const i=o.replace(/([\[\]\{\}\(\)\|\=\;\+\?\,\.\*\^\$])/gi,"\\$1");return new RegExp("(?:^"+i+"|;\\s*"+i+")=(.*?)(?:;|$)","g")}static safeDecodeURIComponent(o){try{return decodeURIComponent(o)}catch(i){return o}}check(o){return!!this.documentIsAccessible&&(o=encodeURIComponent(o),l.getCookieRegExp(o).test(this.document.cookie))}get(o){if(this.documentIsAccessible&&this.check(o)){o=encodeURIComponent(o);const c=l.getCookieRegExp(o).exec(this.document.cookie);return c[1]?l.safeDecodeURIComponent(c[1]):""}return""}getAll(){if(!this.documentIsAccessible)return{};const o={},i=this.document;return i.cookie&&""!==i.cookie&&i.cookie.split(";").forEach(c=>{const[g,h]=c.split("=");o[l.safeDecodeURIComponent(g.replace(/^ /,""))]=l.safeDecodeURIComponent(h)}),o}set(o,i,c,g,h,m,k){if(!this.documentIsAccessible)return;if("number"==typeof c||c instanceof Date||g||h||m||k)return void this.set(o,i,{expires:c,path:g,domain:h,secure:m,sameSite:k||"Lax"});let p=encodeURIComponent(o)+"="+encodeURIComponent(i)+";";const a=c||{};a.expires&&(p+="number"==typeof a.expires?"expires="+new Date((new Date).getTime()+1e3*a.expires*60*60*24).toUTCString()+";":"expires="+a.expires.toUTCString()+";"),a.path&&(p+="path="+a.path+";"),a.domain&&(p+="domain="+a.domain+";"),!1===a.secure&&"None"===a.sameSite&&(a.secure=!0,console.warn(`[ngx-cookie-service] Cookie ${o} was forced with secure flag because sameSite=None.More details : https://github.com/stevermeister/ngx-cookie-service/issues/86#issuecomment-597720130`)),a.secure&&(p+="secure;"),a.sameSite||(a.sameSite="Lax"),p+="sameSite="+a.sameSite+";",this.document.cookie=p}delete(o,i,c,g,h="Lax"){if(!this.documentIsAccessible)return;const m=new Date("Thu, 01 Jan 1970 00:00:01 GMT");this.set(o,"",{expires:m,path:i,domain:c,secure:g,sameSite:h})}deleteAll(o,i,c,g="Lax"){if(!this.documentIsAccessible)return;const h=this.getAll();for(const m in h)h.hasOwnProperty(m)&&this.delete(m,o,i,c,g)}}return l.\u0275fac=function(o){return new(o||l)(v.LFG(d.K0),v.LFG(v.Lbi))},l.\u0275prov=v.Yz7({token:l,factory:l.\u0275fac,providedIn:"root"}),l})()}}]);